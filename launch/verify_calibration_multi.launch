<launch>

  <!-- CAMERA -->
  <!-- Launch the camera driver separately, cuz there's a race condition and sleeping is hard... -->

  <!-- Launch static publishers which describe the frame of the tag w.r.t. the robot. -->
  <include file="$(find rpad_ros)/launch/calibration_frame_publishers.launch" />
  <arg name="sensor_sn_0" default="$(eval '000003493812,000180921812,000059793712,000263392612'.split(',')[0])"/>
  <arg name="sensor_sn_1" default="$(eval '000003493812,000180921812,000059793712,000263392612'.split(',')[1])"/>
  <arg name="sensor_sn_2" default="$(eval '000003493812,000180921812,000059793712,000263392612'.split(',')[2])"/>
  <arg name="sensor_sn_3" default="$(eval '000003493812,000180921812,000059793712,000263392612'.split(',')[3])"/>
  <!-- Launch the robot planning scene! -->
  <include file="$(find rpad_ros)/launch/table1_planning_scene.launch" />

  <group ns="k4a_0">
    <include file="$(find azure_kinect_ros_driver)/launch/kinect_rgbd.launch">
      <arg name="sensor_sn" value="$(arg sensor_sn_0)"/>
      <arg name="tf_prefix" value="k4a_0/"/>
      <!-- <arg name="color_resolution" value="1080P"/> -->
      <arg name="color_resolution" value="1536P"/>
      <arg name="depth_mode" value="NFOV_UNBINNED"/>

      <!-- 2160 -->

      <arg name="required" value="true"/>
      <arg name="overwrite_robot_description" value="false"/>
      <arg name="point_cloud" value="false"/>
      <arg name="rgb_point_cloud" value="false"/>
      <arg name="ir_mono8_scaling_factor" value="0.05" />
    </include>
  </group>

  <include file="$(find rpad_ros)/launch/publish_calibration.launch">
      <arg name="namespace_prefix" value="k4a_0"/>
      <arg name="tracking_base_frame" value="k4a_0/camera_base"/>
  </include>

  

  <group ns="k4a_1">
    <include file="$(find azure_kinect_ros_driver)/launch/kinect_rgbd.launch">
      <arg name="sensor_sn" value="$(arg sensor_sn_1)"/>
      <arg name="tf_prefix" value="k4a_1/"/>
      <!-- <arg name="color_resolution" value="1080P"/> -->
      <arg name="color_resolution" value="1536P"/>
      <arg name="depth_mode" value="NFOV_UNBINNED"/>

      <arg name="required" value="true"/>
      <arg name="overwrite_robot_description" value="false"/>
      <arg name="point_cloud" value="false"/>
      <arg name="rgb_point_cloud" value="false"/>
      <arg name="ir_mono8_scaling_factor" value="0.05" />
      <arg name="node_start_delay" value="2.0"/>
    </include>
  </group>


    <!-- Run a VoxelGrid filter to clean NaNs and downsample the data -->


    <include file="$(find rpad_ros)/launch/launch_filters.launch">
      <arg name="camera_id" value="0"/>
    </include>

        <include file="$(find rpad_ros)/launch/launch_filters.launch">
      <arg name="camera_id" value="1"/>
    </include>


    <include file="$(find rpad_ros)/launch/launch_filters.launch">
      <arg name="camera_id" value="2"/>
    </include>


    <include file="$(find rpad_ros)/launch/launch_filters.launch">
      <arg name="camera_id" value="3"/>
    </include>


    <include file="$(find rpad_ros)/launch/publish_calibration.launch">
      <arg name="namespace_prefix" value="k4a_1"/>
      <arg name="tracking_base_frame" value="k4a_1/camera_base"/>
  </include>

  <group ns="k4a_2">
    <include file="$(find azure_kinect_ros_driver)/launch/kinect_rgbd.launch">
      <arg name="sensor_sn" value="$(arg sensor_sn_2)"/>
      <arg name="tf_prefix" value="k4a_2/"/>
      <!-- <arg name="color_resolution" value="1080P"/> -->
      <arg name="color_resolution" value="1536P"/>
      <arg name="depth_mode" value="NFOV_UNBINNED"/>

      <arg name="required" value="true"/>
      <arg name="overwrite_robot_description" value="false"/>
      <arg name="point_cloud" value="false"/>
      <arg name="rgb_point_cloud" value="false"/>
      <arg name="ir_mono8_scaling_factor" value="0.05" />
      <arg name="node_start_delay" value="4.0"/>
    </include>
  </group>

    <include file="$(find rpad_ros)/launch/publish_calibration.launch">
      <arg name="namespace_prefix" value="k4a_2"/>
      <arg name="tracking_base_frame" value="k4a_2/camera_base"/>
  </include>


  <group ns="k4a_3">
    <include file="$(find azure_kinect_ros_driver)/launch/kinect_rgbd.launch">
      <arg name="sensor_sn" value="$(arg sensor_sn_3)"/>
      <arg name="tf_prefix" value="k4a_3/"/>
      <!-- <arg name="color_resolution" value="1080P"/> -->
      <arg name="color_resolution" value="1536P"/>
      <arg name="depth_mode" value="NFOV_UNBINNED"/>

      <arg name="required" value="true"/>
      <arg name="overwrite_robot_description" value="false"/>
      <arg name="point_cloud" value="false"/>
      <arg name="rgb_point_cloud" value="false"/>
      <arg name="ir_mono8_scaling_factor" value="0.05" />
      <arg name="node_start_delay" value="6.0"/>
    </include>
  </group>


  <include file="$(find rpad_ros)/launch/publish_calibration.launch">
      <arg name="namespace_prefix" value="k4a_3"/>
      <arg name="tracking_base_frame" value="k4a_3/camera_base"/>
  </include>

  <node type="rviz" name="rviz" pkg="rviz" args="-d $(find rpad_ros)/launch/rviz/verify_calibration_multi.rviz" />

</launch>