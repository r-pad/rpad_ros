<launch>

    <arg name="camera_id" default="0"/>

    <node pkg="nodelet" type="nodelet" name="pcl_manager_$(arg camera_id)" args="manager" output="screen" />

    <!-- Filter nans -->
    <!-- Run a passthrough filter to clean NaNs -->
    <node pkg="nodelet" type="nodelet" name="passthrough_$(arg camera_id)" args="load pcl/PassThrough pcl_manager_$(arg camera_id)" output="screen">
      <remap from="~input" to="/k4a_$(arg camera_id)/depth_to_rgb/points" />
      <remap from="~output" to="/k4a_$(arg camera_id)/depth_to_rgb/nonnan_points" />
      <rosparam>
        filter_field_name: z
        filter_limit_min: -1.5
        filter_limit_max: 1.5
        filter_limit_negative: False
      </rosparam>
    </node>

    <!-- CropBox -->
    <node pkg="nodelet" type="nodelet" name="crop_box_$(arg camera_id)" args="load pcl/CropBox pcl_manager_$(arg camera_id)" output="screen">
        <remap from="~input" to="/k4a_$(arg camera_id)/depth_to_rgb/nonnan_points" />
        <remap from="~output" to="/k4a_$(arg camera_id)/depth_to_rgb/cropped_points" />
        <rosparam>
        min_x: 0.1
        max_x: 0.8
        min_y: -0.7
        max_y: 0.15
        min_z: -0.1
        max_z: 0.7
        input_frame: /world
        </rosparam>
    </node>

    <!-- Voxelize. -->
    <node pkg="nodelet" type="nodelet" name="voxel_grid_$(arg camera_id)" args="load pcl/VoxelGrid pcl_manager_$(arg camera_id)" output="screen">
      <remap from="~input" to="/k4a_$(arg camera_id)/depth_to_rgb/cropped_points" />
      <remap from="~output" to="/k4a_$(arg camera_id)/depth_to_rgb/voxelized_points" />
      <rosparam>
        filter_field_name: z
        filter_limit_min: 0.01
        filter_limit_max: 2.0
        filter_limit_negative: False
        leaf_size: 0.001
      </rosparam>
    </node>

    <!-- RadiusOutlierRemoval -->
    <!-- <node pkg="nodelet" type="nodelet" name="radius_outlier_removal_$(arg camera_id)" args="load pcl/RadiusOutlierRemoval pcl_manager_$(arg camera_id)" output="screen">
        <remap from="~input" to="/k4a_$(arg camera_id)/depth_to_rgb/voxelized_points" />
        <remap from="~output" to="/k4a_$(arg camera_id)/depth_to_rgb/downsampled_points" />
        <rosparam>
        radius_search: 0.005
        min_neighbors: 25
        </rosparam>
    </node> -->


    <node pkg="nodelet" type="nodelet" name="outlier_$(arg camera_id)" args="load pcl/StatisticalOutlierRemoval pcl_manager_$(arg camera_id)" output="screen">
        <remap from="~input" to="/k4a_$(arg camera_id)/depth_to_rgb/voxelized_points" />
        <remap from="~output" to="/k4a_$(arg camera_id)/depth_to_rgb/downsampled_points" />
        <rosparam>
        mean_k: 50
        stddev: 2.0
        negative: false
        </rosparam>
    </node>

    <!-- Run a VoxelGrid filter to clean NaNs and downsample the data -->


</launch>